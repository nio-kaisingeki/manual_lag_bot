{% extends 'base.html' %}
{% block content %}
<h1>非同期チャット</h1>
<div id="chat-box" class="chat-box"></div>
<input type="text" id="user-input" placeholder="メッセージを入力..." />
<button id="send-btn">送信</button>
<script>
const chatBox = document.getElementById('chat-box');
const input = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');

sendBtn.addEventListener('click', () => {
    const userInput = input.value;
    chatBox.innerHTML += `<div class="user-message">${userInput}</div>`;
    input.value = '';
    fetch('{% url "chat" %}', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded', 'X-CSRFToken': '{{ csrf_token }}' },
        body: new URLSearchParams({ message: userInput })
    })
    .then(response => response.json())
    .then(data => {
        chatBox.innerHTML += `<div class="bot-message">${data.response}</div>`;
    });
});
</script>
{% endblock %}
